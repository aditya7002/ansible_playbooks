
--- 

- hosts: all
  user: ansadm
  become: yes
  become_method: sudo

  tasks:

  - name: 1. Install Apache (httpd)
    yum: name=httpd state=present
    tags: install_apache

  - name: 2. Start httpd service
    service: name=httpd state=started enabled=yes
    tags: start_httpd

  - name: 3. Install mariadb-server
    yum:
      name:
        - mariadb
        - mariadb-server
      state: present
    tags: install_mariadb_server

  - name: Start mariadb service
    service: name=mariadb state=started
    tags: start_mariadb

  - name: update mysql root password for all root accounts
    mysql_user: name=root host={{ item }} password=vlink config_file=/etc/my.cnf
    with_items:
        - "kubernetus"
        - 127.0.0.1
        - ::1
        - localhost
  
    tags: reset_root_password

  - name: Copying my.cnf file to /etc location
    template: src=/home/ansadm/ansible_playbooks/template_files/my.cnf dest=/etc owner=mysql group=mysql
    tags: copy_my_cnf

  - name: Restart mariadb service
    service: name=mariadb state=restarted
    tags: restart_mariadb

  # Install php 7

  - name: Install epel-release
    yum: name=epel-release state=present
    tags: install_epel

  - name: Install remi-release
    yum: 
      name: 
        - http://rpms.remirepo.net/enterprise/remi-release-7.rpm 
      state: present
    tags: install_remi_release

  - name: Installing yum utils
    yum:
      name: 
        - yum-utils
      state: latest
    tags: install_yum_utils

  - name: Enable Remi repository for PHP7
    yum_repository:
             name: remi-php73
             description: Remi's PHP 7.3 RPM repository for Enterprise Linux 7 - $basearch
             mirrorlist: http://cdn.remirepo.net/enterprise/7/php73/mirror
             enabled: yes
             gpgcheck: yes
             gpgkey: file:///etc/pki/rpm-gpg/RPM-GPG-KEY-remi

    tags: enable_remi

  - name: Installing PHP 7
    yum:
     name:
       - php
       - php-mcrypt
       - php-cli
       - php-gd
       - php-curl
       - php-mysql
       - php-ldap
       - php-zip
       - php-fileinfo

     state: present

    tags: install_php_7
