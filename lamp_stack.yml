
---

- hosts: all
  user: ansadm
  roles:
     - webservers
     - database
  vars:
     - mysql_username: root
     - mysql_password: joomla
  become: yes
  become_method: sudo

  tasks:

     - name: Install apache
       yum: name=httpd state=present
       notify: start httpd
       tags: install_apache

     # Running the handler named 'start httpd' at this point only instead of the end of the playbook using below statement
     - meta: flush_handlers

     - name: Install mariadb
       yum: 
         name:
           - mariadb
           - mariadb-server
         state: present

       notify: start mariadb
       tags: install_mariadb

     - meta: flush_handlers

     - name: Install python2-pip
       yum:
        name: python2-pip
        state: present
       tags: install_python2-pip

     - name: Install PyMySQL python module
       pip:
        name: PyMySQL
       tags: install_pymysql

     - name: Reset mariadb root password
       mysql_user: name=root password=joomla config_file=/etc/my.cnf
       tags: reset_mariadb_password

     - name: Copy my.cnf to /etc location
       template: src=/home/ansadm/ansible_playbooks/template_files/my.cnf dest=/etc owner=mysql group=mysql
       notify: restart mariadb
       tags: copy_my_cnf

     - meta: flush_handlers
